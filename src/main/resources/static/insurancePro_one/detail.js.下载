define(["jquery","underscore","exports","require","module","helper","http-util","layer","top-menu","message","campaign-code-generate","animate-fly"],function($,d,e,o,t,c,l,u,i,a,p){"use strict";var n,r,f={message:new a,isLogin:!1,renewalNum:"",isRenewal:!1,toolFloat:{},trialBox:{},hxysPlanIds:[100784,100785,100786],init:function(e){var t,i;if(this.trialBox=e,f.render.initTool(),f.group.init(),-1<c.cookie.getCookie("compareProducts").indexOf($("#planId").val()||$("#productId").val())&&($("#addToCompare").addClass("hz-check-item-checked"),$("#addToCompare .hz-check-text").html("已加入对比")),$("#pcProductStatus").val(),f.actions.addHistoryPlan($("#planId").val()||$("#productId").val(),$("#productId").val()),f.actions.getProductStatus(),f.actions.replaceProduct(),f.actions.initActivityEvent(),t=c.url.getUrlVar("ep")){var n={};(t=t.split("~")).forEach(function(e,t){var i=e.split("_")[0],a=e.split("_")[1];n[i]=a}),f.renewalNum=n.ins,f.isRenewal="1"===n.IsRenewal}(i=c.url.getUrlVar("renewalInsureNum"))&&(f.renewalNum=i,f.isRenewal=!0,$(".hz-button-primary[insuredstart]").text("立即续保")),f.render.combineProtect()},io:{},topMenu:{},render:{initTool:function(){requirejs(["share-panel","fix-float","fixed-tool-float"],function(e,t,i){new e({items:["sina","zone"],url:location.href,summary:$("#productName").val()+($("#productPlanName").html()||""),productId:$("#productId").val(),planId:$("#planId").val()||$("#productId").val()}),new t({el:$("#detialTab"),fixPanel:$("#detaTabLayout"),fixClass:"fixed-detail-tab-wrap"}),new t({el:$("#silderbar"),fixPanel:$("#detaTabLayout"),fixClass:"fixed-sidebar"});f.toolFloat=new i,f.actions.isFavorite(),f.actions.initAction()}),c.state.checkLogin(function(e){var i="//is.huize.com/api/users/kefuRewrite?productTypeId="+$("#categoryId").val()+"&referrer="+encodeURIComponent(window.location.href)+"&title="+encodeURIComponent(document.title);f.isLogin=e.result,window.__userStatus.isLogin=!!e.result,f.isLogin?(c.request.getJson({url:"/api/users/customer-service"},function(e){if((n=e.result)&&n.userId){var t=c.cookie.getCookie("userId");i+="&mid="+encodeURIComponent(t)}n&&n.adviserInfoList&&1===n.isBind&&0!==n.adviserInfoList.length?($("#contactkefu").removeClass("fn-hide"),$("#onlinekefu").addClass("fn-hide"),i+="&consultant="+encodeURIComponent(n.adviserInfoList[0].employeeNo),$("#contactkefu").attr("href",i)):($("#onlinekefu").removeClass("fn-hide"),$("#onlinekefu").attr("href",i))}),c.cookie.getCookie("eid")||f.actions.browsHistory(),c.request.getJson({url:"/api/insurance-slips/leaderClub/queryIdentifyResult"},function(e){window.__userStatus.leaderDetail=e.result||{}})):($("#onlinekefu").removeClass("fn-hide"),$("#onlinekefu").attr("href",i))})},combineProtect:function(){var t,i,a,n=$("#protectArea li[trialitemid]");n.each(function(e){t=$(this),i=$(n[e+1]),a=0<=e-1?$(n[e-1]):null,t&&i&&t.attr("trialitemid")===i.attr("trialitemid")&&t.css("border-bottom","none"),t&&a&&t.attr("trialitemid")===a.attr("trialitemid")&&($("#protectArea .row01 div",t).hide(),$("#protectArea .row02 div",t).hide())})}},actions:{leaderClubProduct:function(){if(window.__leaderOnly&&-1<window.__leaderOnly.indexOf($("#productId").val())&&3!=window.__userStatus.leaderDetail.verifyStatus){var e=window.__userStatus,t={title:"",btn:["前往认证","我已认证"],area:"530px"},i="/insure/group/leaderclub";if(e.isLogin)switch(t.btn.splice(-1),e.leaderDetail.verifyStatus){case 1:t.btn[0]="审核中，请耐心等待",i="/insure/group/leaderclub";break;case 2:t.btn[0]="审核未通过，点击查看原因",i="/insure/group/leaderclub";break;case 3:break;default:i="/insure/group/leaderclub"}return u.confirm('<div class="pt45 pb35 tac f20 fc3"><p class="pt5 pb5">此产品为慧择HUTS团体/领队俱乐部会员专属产品</p><p class="pt5">只有认证通过才能投保哦</p></div>',t,function(){window.location.href=i},function(){requirejs(["sign-float"],function(e){new e({returnUrl:location.href,showRegister:!0,callback:function(e){location.reload()}})})}),!1}return!0},initAction:function(){function e(){var e=window.document.body.clientWidth||0;$("#detialTab").hasClass("fixed-detail-tab-wrap")&&e<1190?$("#detialTab .layout").width(e):$("#detialTab .layout").width(1190),$("#silderbar").hasClass("fixed-sidebar")&&e<1190?$("#silderbar").css("right","6px"):$("#silderbar").css("right","auto")}var i=this;e(),$(window).scroll(function(){e()}),$("#favorite").bind("click",function(){f.isLogin?$("#favorite").hasClass("active")?u.confirm("<div class='pt45 pb45 tac'>确定取消该产品的收藏吗</div>",{btn:["取消","确定"],area:"530px",title:!1,btn1:function(e){u.close(e)},btn2:function(e){$.ajax({type:"delete",url:"/api/products/"+$("#productId").val()+"/plans/"+$("#planId").val()+"/collections",dataType:"json",success:function(e){"00000"===e.status&&e.result?(u.msg("取消成功"),$("#favorite").removeClass("active").find("span").text("收藏"),$("#favorite").find(".iconfont").html("&#xe741;")):u.msg("取消失败")},error:function(e){}})}}):$.ajax({type:"post",url:"/api/products/"+$("#productId").val()+"/plans/"+$("#planId").val()+"/collections",dataType:"json",success:function(e){"00000"===e.status&&e.result?(u.msg("收藏成功"),$("#favorite").addClass("active").find("span").text("已收藏"),$("#favorite").find(".iconfont").html("&#xe744;")):u.msg("收藏失败")},error:function(e){}}):requirejs(["sign-float"],function(e){new e({returnUrl:location.href,showRegister:!0,callback:function(e){location.reload()}})})}),$("#addToCompare").bind("click",function(){if($(this).hasClass("hz-check-item-checked"))$(this).removeClass("hz-check-item-checked"),f.toolFloat.delcomparePro($("#planId").val()||$("#productId").val()),$("#addToCompare .hz-check-text").html("加入对比");else{if(4<=f.toolFloat.getCompareCount())return void u.msg("对比数目最大不能超过4个");$(this).addClass("hz-check-item-checked"),$("#addToCompare .hz-check-text").html("已加入对比"),$("#fixedsidetool").css("right",0),$("#wrapToolMenu").css("left",0),f.actions.animateFly($(this),$("#compareCount"),function(){f.toolFloat.addcomparePro($("#planId").val()||$("#productId").val())})}}),$("a[addtoShopCar],a[insuredstart]").bind("click",function(e){if(!f.actions.leaderClubProduct())return!1;if(!$(this).hasClass("hz-button-disabled"))if($("a[insuredstart]").hasClass("HZJTBZXQ-993"))u.msg("单笔总保费如超20万，将无法正常投保。建议拆单或降低保额，详情可联系您的保险咨询顾问。");else{var t=this,i=$(t).attr("insuredstart")!==undefined;if(i&&"2"==$("#pcBuyType").val()){var a=$("#companyBuyUrl").val();return-1===a.indexOf("http://")&&(a="http://"+a),void c.page.openNewTag(a)}var n=function(){if(i&&1===r.orderStatus){r.failureTimeEnd.split("T")[1].split(":");u.confirm(r.notice.replace("#00:00#","<font color='red'>"+r.endHour+"</font>"),{btn:["看看同类产品","继续购买"],area:"530px",btn1:function(){c.page.openNewTag("/product/ins-"+$("#categoryId").val()+"-0-0")},btn2:function(){f.actions.insureCreate(t)}})}else f.actions.insureCreate(t)};f.actions.hxysProductInsureFix(this)||(void 0!==r||i?n():f.actions.getProductStatus(function(e){r=e.result,n()}))}}),$("#recommendTableContent").delegate(".hz-button","click",function(){for(var e=$("div[data-tab='recommend-"+$(this).attr("dindex")+"'] ul li"),t=[],a=$(this),i=0;i<e.length;i++)$(e[i]).attr("planId")&&t.push({planId:$(e[i]).attr("planId"),productId:$(e[i]).attr("productId"),inShoppingCart:!0});c.request.postData2({url:"/api/insurance-slips",data:t},function(e){var t=e.result;if(t)if(f.isLogin)f.actions.animateFly($(a),$("#showCarBtn"),function(){u.msg("加入购物车成功"),f.toolFloat.refreshShopCar()});else{var i=c.cookie.getCookie("InsureNums");20!==i.split(",").length?($(t).each(function(e,t){-1===i.indexOf(t.insureNum)&&(i?i=i+","+t.insureNum:i+=t.insureNum,c.cookie.setCookie("InsureNums",i,864e5,".huize.com"))}),f.actions.animateFly($(a),$("#showCarBtn"),function(){u.msg("加入购物车成功"),f.toolFloat.refreshShopCar()})):u.alert("购物车数量达到上限，请先结算购物车中的产品",{btn:["去购物车"]},function(e){u.close(e),location.href="//is.huize.com/shopping-cart/"})}else u.msg(e.message||"添加购物车失败")})}),$("#planIdBox .primary-link").bind("click",f.actions.showPlansCompare),$(".js-act-coupons").on("click",function(){var t=this;f.isLogin?i.popCouponList(t):c.state.checkLogin(function(e){f.isLogin=e.result,f.isLogin?i.popCouponList(t):requirejs(["sign-float"],function(e){new e({returnUrl:location.href,showRegister:!0,callback:function(e){}})})})}),$(".yuyue-kefu").on("click",f.actions.yuyueKefu),$("body").on("click","[data-custom-track]",function(e){var t=$(this).data("custom-track");ga("send","event","toubao","PCtoubao",$(this).attr("data-custom-track"),1),"function"==typeof customTrack&&customTrack(t)}).on("click","#kefuShuntMark",function(){$("#kefu").click()}).on("click",".js-hz-agreement",function(){f.actions.showHzAgreement()})},initActivityEvent:function(){$(".js-activity").on("click",function(e){var t=$(e.currentTarget);t.closest(".ensure-opt-tr").find("td").eq(0).html();u.open({type:1,content:'<div class="activity-content">'+t.data("explain")+"</div>",title:'<div class="activity-title">'+t.data("title")+"</div>"})})},getCouponListHtml:function(e,i){l.fetch("/api/products/activity/coupons",{data:{planId:e}},function(e){var t=d.template($("#tpl-tickets-list").html(),{variable:"data"})(e);i(t)})},popCouponList:function(a){var r=this,n=$(a).closest("[data-act-ids]"),s=$("#planId").val();r.getCouponListHtml(s,function(e){var t=2*(a.getBoundingClientRect()||{top:0}).top>window.innerHeight,i={};t?i.bottom=$(a).height()+20+"px":i.top=$(a).height()+20+"px";var o=$(e).appendTo(n).css(i);o.removeClass("top bottom").addClass(t?"bottom":"top"),c.utils.bindFocusOut({element:o,persistent:!1,callback:function(){o.remove()}}),o.on("click",".js-coupon",function(e){var t,i=$(e.target),a=i.attr("data-id"),n=parseInt(i.attr("data-activity-id"));(a||n)&&(n?(t=d.find(window.__coupons,{id:n}))&&t.activityPcUrl?window.open(t.activityPcUrl,"_blank"):window.open("/product/ins-0-0-0?activityType=coupon&activityId="+n):l.fetch("/api/products/activity/get-coupon",{data:{couponsId:a}},function(e){0==e.status&&u.msg("领取成功"),r.getCouponListHtml(s,function(e){var t=$(e).find(".hz-coupon-list");t.length?(o.find(".hz-coupon-list").remove(),o.append(t)):o.remove()})}))}).on("click",".close-button",function(){o.remove()})})},replaceProduct:function(){var e=$("#pcProductStatus").val(),t=$("#pcReplaceId").val(),n=this;"2"===e&&t&&c.request.getJson({url:"/api/products/plans/"+t+"/similar"},function(a){a.result&&o(["require-text!/html/product/replace-product-inner.html"],function(e){var t,i;$.each(a.result.restrictRules&&a.result.restrictRules.protectTrialItemList||[],function(){t=this.relateCoverageId,i=this,t&&$.each(a.result.restrictRules.restrictGenes,function(){this.protectItemId===~~t&&(this.defaultValue?i.fullPremium=this.defaultValue:this.dictionaryList&&0<this.dictionaryList.length&&(i.fullPremium=this.dictionaryList[0].value+n.getUnit(this.dictionaryList[0].unit)))})}),$("#offlineNotice").html(d.template(e)({data:a.result})),$("#togReplaceDetail").on("click",function(e){var t=$(e.currentTarget),i=$("#detail-panel");i.is(":visible")?t.html('展开 <i class="iconfont">&#xe70d;</i>'):t.html('收起 <i class="iconfont">&#xe708;</i>'),i.slideToggle()})})})},getProductStatus:function(e){c.request.getJson({url:"/api/products/"+$("#productId").val()+"/issuing-state"},function(e){r=e.result;var t=$("#pcProductStatus").val();if(2===r.orderStatus&&("2"===t||"0"===t)){var i=r.failureTimeEnd.split("T"),a=i[0].split("-"),n=i[1].split(":"),o=r.notice.replace("yyyy",a[0]).replace("MM",a[1]).replace("dd",a[2]).replace("HH",n[0]).replace("mm",n[1]).replace("#","<font color='red'>").replace("#","</font>").replace(/"/g,"");c.page.showSingleBtn(o,function(){c.page.openNewTag("/product/ins-"+$("#categoryId").val()+"-0-0")},"看看同类产品")}},function(e){})},showPlansCompare:function(){var e,t,i=[],n=[];$("#planIdBox a.filter-tag ").each(function(){e=$(this).data("productplanid"),t=$(this).html(),i.push(e),n.push({planId:e,planName:t})}),c.request.postData2({url:"/api/products/plans-comparison",data:i},function(a){o(["require-text!/html/product/plans-compara.html"],function(e){var t=f.actions.getPlansCompare(a.result,n);u.open({type:1,closeBtn:1,area:["860px","500px"],shift:2,title:"计划对比",shadeClose:!0,content:d.template(e)({plans:n,keyList:t.list,itemIndex:t.count,gens:a.result})});/超级芯爱/.test($("#productName").val())&&$(".tar").each(function(e,t){if("（可选）特定重大疾病高龄保险金"==$(t).html())return $(t).parent().find(".ell").each(function(e,t){$(t).html()&&$(t).html("2.5-30万")}),!1});var i=$("#planList").find(".hz-check-item-checked").length+1;i<6?$("#tabgen").width(800):$("#tabgen").width(160*i),$("#planList").delegate("div","click",function(){var e=$(this).attr("planId");$(this).toggleClass("hz-check-item-checked"),$("#tabgen td[planId="+e+"],#tabgen col[planId="+e+"],#tabgen col[planId="+e+"],#tabgen th[planId="+e+"]").toggleClass("fn-hide");var t=$("#planList").find(".hz-check-item-checked").length+1;t<6?$("#tabgen").width(800).find("col").attr("width",100/t+"%"):$("#tabgen").width(160*t).find("col").attr("width","160px")}),$("#planHead").delegate("th","click",function(){var e="",t=$(this).attr("planId");if($(this).hasClass("active"))e=$(".popover-content.fb",this).html(),$(this).html(e),$(this).removeClass("active"),$("#tabgen td[planId='"+t+"']").removeClass("active");else{if(""===(e=$(this).html()))return;$(this).html('<div class="popover top"><div class="popover-content fb">'+e+'</div><div class="arrow"></div><div class="arrow2"></div></div>'),$(this).addClass("active"),$("#tabgen td[planId='"+t+"']").addClass("active")}}),$("#planHead th[planid='"+$("#planId").val()+"']").click()})})},favoriteAction:function(e){c.request.getCrossJson({url:e.url,data:{productProtectPlanId:$("#planId").val()||$("#productId").val(),isFavorite:!0}},function(e){e.IsSuccess?(u.msg("收藏成功"),$("#favorite").addClass("active").find("span").text("已收藏"),$("#favorite").find(".iconfont").html("&#xe744;")):u.msg("收藏失败")})},browsHistory:function(){$.ajax({type:"POST",url:"/api/users/browsing-history?type=1&id="+$("#productId").val()+"&planId="+$("#planId").val(),dataType:"json",error:function(e){}})},isFavorite:function(){$.ajax({type:"get",url:"/api/products/"+$("#productId").val()+"/plans/"+$("#planId").val()+"/is-collected",dataType:"json",success:function(e){"00000"===e.status&&e.result&&($("#favorite").addClass("active").find("span").text("已收藏"),$("#favorite").find(".iconfont").html("&#xe744;"))},error:function(e){}})},addHistoryPlan:function(e,t){if(e){var i,a=c.cookie.getCookie("Product_History"),n=a.split(",");if(20<=n.length){var o=n[n.length-1];a=i=this.cookieStr(a,o.split(":")[1],o.split(":")[0],2)}(i=this.cookieStr(a,e,t,1))&&0<i.length&&c.cookie.setCookie("Product_History",i,432e6,".huize.com")}},animateFly:function(e,t,i){var a=$('<img class="u-flyer" src="//img.huizecdn.com/hz/www/page/cart-flyer.png">').width(40).height(40),n=document.body.scrollTop||document.documentElement.scrollTop,o=e.offset().top-e.height()/2-n,r=e.offset().left+e.width()/2,s=t.offset().top+t.height()/2-n;a.fly({start:{left:r,top:o},end:{left:t.offset().left,top:s,width:0,height:0},onEnd:function(){"function"==typeof i&&i()}})},cookieStr:function(e,t,i,a){var n=e.split(","),o="";if(n=$.grep(n,function(e){return""!==e}),1===a){for(var r=0;r<n.length;r++)if(n[r]===i+":"+t||n[r].split(":")[0]===i+"")return o=n[r],n.splice(r,1),n.unshift(o),n.join(",");n.unshift(i+":"+t)}else for(r=0;r<n.length;r++)if(n[r]===i+":"+t)return n.splice(r,1),n.join(",");return n.join(",")},getUnit:function(e){return{0:"",1:"份",2:"万元",3:"元",4:"0元",5:"00元",6:"000元",7:"岁",8:"年",9:"月",10:"天",11:"元/年"}[e]},getProtectItem:function(i,e){var a;return d.each(e,function(e,t){e.protectItemId===~~i&&(a=e)}),a||{}},getPlanValue:function(e,t,i){var a="";if(e.subRestrictGeneList&&0<e.subRestrictGeneList.length){if(e.subRestrictGeneList[0].dictionaryList&&$.each(i.insureAreaList,function(){a+=this.provinceName,this.cityName&&(a=a+"-"+this.cityName),this.areaName&&(a=a+"-"+this.areaName),a+=","}),a)return 100<a.length?a.substr(0,100).replace(/,$/,"")+"...":a}else if(e.dictionaryList&&0<e.dictionaryList.length&&"insurantJob"===e.key&&($(e.dictionaryList).each(function(){a=a+this.value+","}),a))return a.replace(/,$/,"");return(t?"<p>"+t+"</p>":"")+(e.defaultValue||e.fullPremium||e.premium&&(e.premium/100).toFixed(2)+this.getUnit(e.unit)||"")},getPlansCompare:function(e,a){function i(e,t,i){d.each(e,function(e){c=(e.key||e.name||e.trialItemId)+":"+e.name,e.display&&(n[c]?e.relateCoverageId?n[c][""+a[t].planId]=r.getProtectItem(e.relateCoverageId,i.restrictRuleOperList[0].restrictGenes).defaultValue:n[c][""+a[t].planId]=r.getPlanValue(e,n[c][""+a[t].planId],i):(n[c]={t:e.name},e.relateCoverageId?n[c][""+a[t].planId]=r.getProtectItem(e.relateCoverageId,i.restrictRuleOperList[0].restrictGenes).defaultValue:n[c][""+a[t].planId]=r.getPlanValue(e,n[c][""+a[t].planId],i),o+=1,s.push(n[c])))})}var n={},o=0,r=this,s=[],c="";d.each(e,function(e,t){i(e.restrictRuleOperList[0].restrictGenes,t,e)}),d.each(e,function(e,t){i(e.restrictRuleOperList[0].protectTrialItemList,t,e)});for(var t=s.length,l=0;l<t;l++)for(var u=l+1;u<t;u++)$.trim(s[l].t)===$.trim(s[u].t)&&(s[l]=d.extend(s[l],s[u]),s.splice(u,1),t--);return{list:s,count:o}},checkYuyueName:function(e){return new RegExp("^[\\sA-Za-z_\\u4e00-\\u9fa5]{2,50}$").test(e)},checkYuyueInput:function(t,i,a){t.on("blur",function(){var e=$(this).val();e?i(e)?t.removeClass("form-input-error"):(u.msg(a[1]),t.addClass("form-input-error")):(u.msg(a[0]),t.addClass("form-input-error"))}),t.on("focus",function(){var e=$(this).val();e&&i(e)&&t.removeClass("form-input-error")})},checkYuyueSwzName:function(){var e=$("#yuyueUserName"),t=$.trim(e.val());return t?new RegExp("^[\\sA-Za-z_\\u4e00-\\u9fa5]{2,50}$").test(t)?(e.removeClass("form-input-error"),!0):(u.msg("您输入的姓名格式不正确,请输入正确的姓名！"),e.addClass("form-input-error"),!1):(u.msg("请输入您的姓名！"),e.addClass("form-input-error"),!1)},checkYuyueSwzMobile:function(e){var t=$("#yuyueMobile"),i=$.trim(t.val());return i?c.CheckMobile(i)?(t.removeClass("form-input-error"),!0):(u.msg("请输入正确的手机号"),t.addClass("form-input-error"),!1):(u.msg("请输入您的手机号码"),t.addClass("form-input-error"),!1)},checkSmsCode:function(t){var e="",i=$("#informationVerifycode").val(),a={bizToken:"swz2h_yuyue",mobile:$("#yuyueMobile").val().replace(/^(\s+)|(\s+)$/g,""),smsCode:i};if(/\d{6}/g.test(i)){$("#informationVerifycode").removeClass("form-input-error");try{window.getNVCVal&&(e=window.getNVCVal())}catch(n){}$.ajax({type:"post",url:"/api/smscode/verify",data:JSON.stringify(a),headers:{nvcValue:e,"content-type":"application/json;charset=UTF-8"},success:function(e,t,i){},error:function(e){},complete:function(e){200==e.status?($("#informationVerifycode").removeClass("form-input-error"),t()):(u.msg("当前短信验证码无效或已过期，请重新获取"),$("#informationVerifycode").addClass("form-input-error"))}})}else u.msg("请输入正确的验证码"),$("#informationVerifycode").addClass("form-input-error")},nvcValid:!1,hasNvcCheck:!1,getSmsCode:function(){var e={bizToken:"swz2h_yuyue",mobile:$("#yuyueMobile").val().replace(/^(\s+)|(\s+)$/g,"")},t="";try{window.getNVCVal&&(t=window.getNVCVal())}catch(i){}$.ajax({type:"post",url:"/api/smscode/issue/v2",data:JSON.stringify(e),headers:{nvcValue:t,"content-type":"application/json;charset=UTF-8"},success:function(e){},complete:function(e){var t=e.getResponseHeader("nvccode")||"";try{"200"===t&&t?f.actions.hasNvcCheck=!1:"400"===t?window.getNC&&window.getNC().then(function(){window.NoCaptcha.upLang("cn",f.actions.nvcConfigOpt.sliderUplangH5),window._nvc_nc.reset(),f.actions.hasNvcCheck=!0}):"600"===t?window.getSC&&window.getSC().then(function(){f.actions.hasNvcCheck=!0}):"800"===t&&(u.msg("获取短信验证码失败，请重试"),f.actions.hasNvcCheck=!1)}catch(i){msg("获取短信验证码失败，请重试"),f.actions.hasNvcCheck=!1}}})},nvcConfig:function(){setTimeout(function(){window.NVC_Opt=f.actions.nvcConfigOpt.getBaseConfig({type:"sms",isH5:!0,nvcCallback:function(e){f.actions.nvcValid=!0}});var e=document.createElement("script");e.src="https://static.huizecdn.com/js/plugins/alisd/nvc/1.1.112/guide.js",document.body.appendChild(e)},200)},nvcConfigOpt:{getBaseConfig:function(e){var t={dev:{appKey:"CF_APP_1",scene:"nvc_register"},pc:{login:{appKey:"FFFF000000000176F978",scene:"nvc_login"},sms:{appKey:"FFFF0N0N0000000038C8",scene:"nvc_message"}},h5:{login:{appKey:"FFFF0N0N0000000038C8",scene:"nvc_login_h5"},sms:{appKey:"FFFF0N0N0000000038C8",scene:"nvc_message_h5"}}},i=t.dev||{};return"dev"!==e.type&&(i=e.isH5?t.h5[e.type]||{}:t.pc[e.type]||{}),{appkey:i.appKey||"CF_APP_1",scene:i.scene||"nvc_register",isH5:!!e.isH5,popUp:!1,renderTo:e.renderTo||"#nvcCaptcha_sms",token:[i.appKey,(new Date).getTime(),Math.random()].join(":"),nvcCallback:e.nvcCallback||function(e){},trans:"dev"===e.type?{key1:"code0",nvcCode:600}:{},language:"cn",customWidth:e.customWidth||300,width:e.width||300,height:e.height||100,elements:["//img.huizecdn.com/com/nvc/elements-50-74.png","//img.huizecdn.com/com/nvc/elements-50-74.png"],bg_back_prepared:"//img.huizecdn.com/com/nvc/prepared-100-80.png",bg_front:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABQCAMAAADY1yDdAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAADUExURefk5w+ruswAAAAfSURBVFjD7cExAQAAAMKg9U9tCU+gAAAAAAAAAIC3AR+QAAFPlUGoAAAAAElFTkSuQmCC",obj_ok:"//img.huizecdn.com/com/nvc/ok-50-74.png",bg_back_pass:"//img.huizecdn.com/com/nvc/bgok-100-80.png",obj_error:"//img.huizecdn.com/com/nvc/error-50-74.png",bg_back_fail:"//img.huizecdn.com/com/nvc/bgfail-100-80.png",upLang:{cn:{_ggk_guide:"请摁住鼠标左键，刮出两面盾牌验证",_ggk_success:"恭喜您刮出盾牌验证通过<br/>继续下一步操作吧",_ggk_loading:"加载中",_ggk_fail:["呀，盾牌不见了<br/>请",e.isH5?"javascript:NoCaptcha.reset()":"javascript:noCaptcha.reset()","再来一次","或","http://survey.taobao.com/survey/QgzQDdDd?token=%TOKEN","反馈问题"],_ggk_action_timeout:["我等得太久啦<br/>请",e.isH5?"javascript:NoCaptcha.reset()":"javascript:noCaptcha.reset()","再来一次","或","http://survey.taobao.com/survey/QgzQDdDd?token=%TOKEN","反馈问题"],_ggk_net_err:["网络实在不给力<br/>请",e.isH5?"javascript:NoCaptcha.reset()":"javascript:noCaptcha.reset()","再来一次","或","http://survey.taobao.com/survey/QgzQDdDd?token=%TOKEN","反馈问题"],_ggk_too_fast:["您刮得太快啦<br/>请",e.isH5?"javascript:NoCaptcha.reset()":"javascript:noCaptcha.reset()","再来一次","或","http://survey.taobao.com/survey/QgzQDdDd?token=%TOKEN","反馈问题"]}}}},sliderUplangH5:{LOADING:"加载中...",SLIDER_LABEL:"请向右滑动验证",CHECK_Y:"验证通过，继续下一步操作",ERROR_TITLE:"非常抱歉，这出错了...",CHECK_N:"验证未通过",OVERLAY_INFORM:"经检测你当前操作环境存在风险，请输入验证码",TIPS_TITLE:"验证码错误，请重新输入"}},yuyueKefu:function(){var r=$(this).attr("data-custom-yuyueTj");-1<$.trim($(".detail-ensure-body .product-title").text()).indexOf("守卫者2号")?u.open({type:1,content:"<div class='detail-yuyue-form pt45 tac swz-yuyue'><p class='f18 fc3'>对产品感兴趣？</p><p class='f14 fc6 mt15'>您可以留下您的联系方式，预约我们的专家顾问为您讲解产品</p><div class='mt20 mb30 fc3'><input id='yuyueUserName' class='form-input mb20' placeholder='您的称呼'/><input id='yuyueMobile' class='form-input mb20' placeholder='您的手机'/><div class='code-box'><input id='informationVerifycode' class='form-input' placeholder='手机验证码'><div class='verifycode-btn' id='getCodeBtn'>获取验证码</div></div></div></div>",btn:["提交预约"],closeBtn:!0,area:"530px",title:!1,success:function(e){e.append("<div style='height: 50px;text-align: center;width: 400px;color: #999;margin: -20px auto 0;position: relative;     z-index: 1000;'>您的信息仅供预约咨询所用，不泄露至任何第三方或用于其他用途。</div>");var t=$("#yuyueUserName"),i=$("#yuyueMobile"),a=null;f.actions.checkYuyueInput(t,f.actions.checkYuyueName,["请输入您的姓名","您输入的姓名格式不正确,请输入正确的姓名"]),f.actions.checkYuyueInput(i,c.CheckMobile,["请输入您的手机号码","请输入正确的手机号"]),f.actions.nvcConfig(),$("#getCodeBtn").click(function(){if(null==a&&f.actions.checkYuyueSwzName()&&f.actions.checkYuyueSwzMobile()){f.actions.getSmsCode();var e=60,t=$(this);t.html(e+"秒"),a=setInterval(function(){--e<1?(t.html("发送验证码"),clearInterval(a),a=null):t.html(e+"秒")},1e3)}})},yes:function(){if(!f.lockSubmitYuyue){var e,t=$("#yuyueUserName"),i=$.trim(t.val()),a=$("#yuyueMobile"),n=$.trim(a.val()),o=$("#informationVerifycode")?$("#informationVerifycode"):"";$("#informationVerifycode")&&$.trim(o.val());e=2==+(0<$("#shuntMark").length?$("#shuntMark").val():0)?"产品详情页预约 "+$.trim($(".detail-ensure-body .product-title").text())+"a":"产品详情页预约 "+$.trim($(".detail-ensure-body .product-title").text()),f.actions.checkYuyueSwzName()&&f.actions.checkYuyueSwzMobile()&&(f.actions.hasNvcCheck&&!f.actions.nvcValid?window._nvc_nc.reset():f.actions.submitYuyue(i,n,r,e,!0))}}}):u.open({type:1,content:"<div class='detail-yuyue-form pt45 tac'><p class='f18 fc3'>对产品感兴趣？</p><p class='f14 fc6 mt15'>您可以留下您的联系方式，预约我们的专家顾问为您讲解产品</p><div class='mt20 mb30 fc3'><input id='yuyueUserName' class='form-input mr20' placeholder='您的称呼'/><input id='yuyueMobile' class='form-input' placeholder='您的手机'/></div>",btn:["提交预约"],closeBtn:!0,area:"530px",title:!1,success:function(e){e.append("<div style='height: 50px;text-align: center;width: 400px;color: #999;margin: -20px auto 0;position: relative;     z-index: 1000;'>您的信息仅供预约咨询所用，不泄露至任何第三方或用于其他用途。</div>");var t=$("#yuyueUserName"),i=$("#yuyueMobile");f.actions.checkYuyueInput(t,f.actions.checkYuyueName,["请输入您的姓名","您输入的姓名格式不正确,请输入正确的姓名"]),f.actions.checkYuyueInput(i,c.CheckMobile,["请输入您的手机号码","请输入正确的手机号"])},yes:function(){if(!f.lockSubmitYuyue){var e,t=$("#yuyueUserName"),i=$.trim(t.val()),a=$("#yuyueMobile"),n=$.trim(a.val()),o="";e=2==+(0<$("#shuntMark").length?$("#shuntMark").val():0)?"产品详情页预约 "+$.trim($(".detail-ensure-body .product-title").text())+"a":"产品详情页预约 "+$.trim($(".detail-ensure-body .product-title").text()),i?f.actions.checkYuyueName(i)?(t.removeClass("form-input-error"),n?c.CheckMobile(n)?a.removeClass("form-input-error"):(o="请输入正确的手机号",a.addClass("form-input-error")):(o="请输入您的手机号码",a.addClass("form-input-error"))):(o="您输入的姓名格式不正确,请输入正确的姓名！",t.addClass("form-input-error")):(o="请输入您的姓名！",t.addClass("form-input-error")),o?u.msg(o):f.actions.submitYuyue(i,n,r,e)}}}),$(".layui-layer-btn0").removeClass("layui-layer-btn0").addClass("layui-layer-btn1")},getYuyueCount:function(e){e?l.fetch("/api/reserve/addSubmitAppointCount",{},function(e){}):l.fetch("/api/reserve/getCurrentAppointCount",{},function(e){})},submitYuyue:function(e,t,i,a,n){var o={userName:e,mobile:t,source:1,oppName:a,planId:$("planId").val(),notifyAnswerId:"",contactTime:"",url:window.location.href,platform:2,classify:2,smsCode:$("#informationVerifycode").val(),campaign_code:p.getCode(),productId:p.getProductId()};f.lockSubmitYuyue=!0,u.closeAll(),f.message.show("数据加载中","loading");function r(e){if(f.message.hide(),"00000"===e.status){u.open({type:1,skin:"detail-yuyue-success",closeBtn:1,shift:2,title:!1,area:["530px"],shadeClose:!0,content:'<div class="booking-layer tac pt45 pb45"> <div class="yueyue-success-icon"><i class="iconfont">&#xe72f;</i></div><p class="f18 mb10 mt20">预约成功</p> <p class="fc14 fc6">专业顾问将在<span class="f14" style="color: #f64719;">1个工作日内</span>为您致电服务，<br/>请您留意接听<span class="f14" style="color: #f64719;">本地固话开头的号码</span>或者<span class="f14" style="color: #f64719;">0755开头</span>的电话。</p> </div>',end:function(){}}),$(".layui-layer-btn0").removeClass("layui-layer-btn0").addClass("layui-layer-btn1"),f.actions.getYuyueCount(!0);try{ga("send","event","toubao","PCtoubao",i,1)}catch(t){}"function"==typeof customTrack&&customTrack(i)}else u.open({type:1,skin:"layui-layer-demo",closeBtn:1,shift:2,title:!1,area:["230px"],btn:["确认"],shadeClose:!0,content:'<div class="pt45 pb45 tac">预约失败</div>',btn1:function(){u.closeAll()}});f.lockSubmitYuyue=!1,f.message.hide()}var s={url:"//activities.huize.com/activities/api/common/Appointment",data:o};n?(o.bizToken="swz2h_yuyue",c.request.postData2({url:"/api/reserve/apponitment",data:o},r,function(){f.message.hide()})):c.request.getCrossJson(s,r)},hxysProductInsureFix:function(t){var i=f.trialBox[$("#planId").val()||$("#productId").val()];return!(!d.some(f.hxysPlanIds,function(e){return e===~~i.productPlanId})||f.isLogin)&&(c.state.checkLogin(function(e){f.isLogin=e.result,f.isLogin||requirejs(["sign-float"],function(e){new e({showRegister:!0,callback:function(e){f.isLogin=!0,$(".layui-layer-close").click(),f.actions.insureCreate(t)}})})}),!0)},getInsureCreateData:function(e){var t=f.trialBox[$("#planId").val()||$("#productId").val()],i={restrictRule:{platform:"1",channel:1}};return i.genes=JSON.parse(t.getGenesString()).genes,i.productId=~~t.productId,i.planId=t.productPlanId,i.totalNum=1,i.inShoppingCart=!e,f.isRenewal&&(i.renewalInsureNum=f.renewalNum),c.cookie.getCookie("eid")&&(i.isCreatedByBackgroundUser=!0),i},toLeaderClubPageOrContinueConfirm:function(e){var t="leader-club-general-tip-times-pc-"+$("#productId").val(),i="leader-club-general-close-tip-times-pc",a=~~localStorage.getItem(t),n=~~localStorage.getItem(i),o=window.__leaderclubProductMapping[$("#productId").val()];if(3<=a||5<=n)return e&&e(),!1;u.confirm("您已是团体/领队俱乐部VIP会员，点击前往俱乐部，可立享价格更低、保障更全的产品",{title:"",btn:["关闭","前往俱乐部"],area:"530px",closeBtn:0},function(){localStorage.setItem(i,++n),u.closeAll(),e&&e()},function(){window.location.href=o?"//www.huize.com/product/detail-"+o+".html":"//i.huize.com/#leaderclub/"}),localStorage.setItem(t,++a)},insureCreate:function(t){var i=$(t).attr("insuredstart")!==undefined;c.state.checkLogin(function(e){if(e.result)i?window.__leaderOnly&&-1==window.__leaderOnly.indexOf($("#productId").val())&&3==window.__userStatus.leaderDetail.verifyStatus?f.actions.toLeaderClubPageOrContinueConfirm(function(){f.actions.postInsureOrAddCartData(i)}):f.actions.postInsureOrAddCartData(i):f.actions.postInsureOrAddCartData(i,function(){$("#fixedsidetool").css("right",0),$("#wrapToolMenu").css("left",0),f.actions.animateFly($(t),$("#showCarBtn"),function(){u.msg("加入购物车成功"),f.toolFloat.refreshShopCar()})});else{if(i)return void requirejs(["sign-float"],function(e){new e({returnUrl:location.href,showRegister:!0,callback:function(e){window.__userStatus.isLogin=!0,window.__leaderOnly&&-1==window.__leaderOnly.indexOf($("#productId").val())?c.request.getJson({url:"/api/insurance-slips/leaderClub/queryIdentifyResult"},function(e){window.__userStatus.leaderDetail=e.result||{},3==window.__userStatus.leaderDetail.verifyStatus?f.actions.toLeaderClubPageOrContinueConfirm(function(){f.actions.postInsureOrAddCartData(i)}):f.actions.postInsureOrAddCartData(i)}):f.actions.postInsureOrAddCartData(i)}})});f.actions.postInsureOrAddCartData(i,function(e){var i=c.cookie.getCookie("InsureNums");20!==i.split(",").length?($(e).each(function(e,t){-1===i.indexOf(t.insureNum)&&(i?i=i+","+t.insureNum:i+=t.insureNum,c.cookie.setCookie("InsureNums",i,864e5,".huize.com"))}),$("#fixedsidetool").css("right",0),$("#wrapToolMenu").css("left",0),f.actions.animateFly($(t),$("#showCarBtn"),function(){u.msg("加入购物车成功"),f.toolFloat.refreshShopCar()})):u.alert("购物车数量达到上限，请先结算购物车中的产品",{btn:["去购物车"]},function(e){u.close(e),location.href="//is.huize.com/shopping-cart/"})})}})},bindTouristV:function(){var e=c.cookie.getCookie("touristBroker");e&&c.request.postData2({url:"/api/users/tourist-v/bindTouristVCustomer",data:{data:e}},function(e){e.result&&c.cookie.delCookie("touristBroker",{domain:".huize.com"})},function(e){})},postInsureOrAddCartData:function(n,o){var e=[],r=this.getInsureCreateData(n);e.push(r),n&&f.actions.bindTouristV(),c.request.postData2({url:"/api/insurance-slips",data:e},function(e){var t=e.result;if(t){if("function"==typeof o&&o(t),n){var i="",a="";/IsRenewal_1/i.test(window.location.href)&&(a=(a=window.location.href.match(/startTime_(\d{4}-\d{2}-\d{2})/i))?"&startTime="+a[1]:""),/IsRestrictedEdit_1/i.test(window.location.href)&&(i="&isYiAn=true"),t[0].insureNum&&(0===t[0].healthPosition?location.href="//is.huize.com/product/insure/health-inform?insuranceNum="+t[0].insureNum+"&planId="+t[0].planId+i+a:location.href="//is.huize.com/product/insure?insureNumber="+t[0].insureNum+"&DProtectPlanId="+r.planId+i+a)}}else n?u.msg(e.message||"创建投保单失败"):u.msg(e.message||"添加购物车失败")},function(e){1001===e.status?u.alert(e.message,{btn:["联系客服"]},function(e){u.close(e),$("#kefu").click()}):n?u.msg(e.message||"创建投保单失败"):u.msg(e.message||"添加购物车失败")})},showHzAgreement:function(){var e=$("#tpl-hz-agreement").html();u.open({type:1,content:e,closeBtn:!0,title:!1,area:"600px",shadeClose:!0,success:function(){$(".agreement-box").parent().css({height:"420px"}).parents(".layui-layer").css({top:"140px"})}})}},lockSubmitYuyue:!1,group:{init:function(){var e=d.indexOf([2078,2073,2079,2081],Number($("#categoryId").val()));e<0||($(".yuyue-kefu-group").on("click",this.yuyueKefuGroup),this.loadAd(e))},loadAd:function(e){var t=1<e?3:1,i=1<e?4:2,a=this;c.request.getJson({url:"/api/products/travelAd?bottom="+t+"&right="+i},function(e){e&&"00000"===e.status&&a.render(e.result)})},render:function(e){var t=$("#rightAds"),i=$("#bottomTravelAds"),a=e[0]||{},n=e[1]||{},o=['<a href="',a.linkUrl?a.linkUrl.replace(/http(s*?):/,"").replace("//m.","//www."):"javascript:;",'" target="_blank" title="',a.title,'" class="bottom-travel-ads">','<img src="',a.pictureUrl?a.pictureUrl.replace(/http(s*?):/,""):"",'" alt="',a.description,'">',"</a>"].join(""),r=['<a href="',n.linkUrl?n.linkUrl.replace(/http(s*?):/,"").replace("//m.","//www."):"javascript:;",'" target="_blank" title="',n.title,'"  class="right-travel-ads">','<img src="',n.pictureUrl?n.pictureUrl.replace(/http(s*?):/,""):"",'" alt="',n.description,'">',"</a>"].join("");e[0]&&i.removeClass("fn-hide").html(o),e[1]&&t.removeClass("fn-hide").html(r)},yuyueKefuGroup:function(){var o=$(this).attr("data-custom-yuyueTj");u.open({type:1,content:"<div class='detail-yuyue-form pt45 tac'><p class='f18 fc3'>多人投保怎么操作？</p><p class='f14 fc6 mt15'>被保险人数超过10人？留下联系方式，1对1团体客服稍后为您服务</p><div class='mt20 mb30 fc3'><input id='groupYuyueUserName' class='form-input mr20' placeholder='您的称呼'/><input id='groupYuyueMobile' class='form-input' placeholder='您的手机'/></div></div>",btn:["立即提交"],closeBtn:!0,area:"570px",title:!1,success:function(e){e.append("<div style='height: 50px;text-align: center;width: 400px;color: #999;margin: -20px auto 0;position: relative;     z-index: 1000;'>您的信息仅供预约咨询所用，不泄露至任何第三方或用于其他用途。</div>"),e.append("<div class='group-yuyue-bottom'>工作时间：工作日9:00-18:00，其他时间提交则顺延至工作日或拨打&nbsp;<span class='tel'>4006366366</span>&nbsp;客服电话</div>");var t=$("#groupYuyueUserName"),i=$("#groupYuyueMobile");f.actions.checkYuyueInput(t,f.actions.checkYuyueName,["请输入您的姓名","您输入的姓名格式不正确,请输入正确的姓名"]),f.actions.checkYuyueInput(i,c.CheckMobile,["请输入您的手机号码","请输入正确的手机号"])},yes:function(){if(!f.lockSubmitYuyue){var e=$("#groupYuyueUserName"),t=$.trim(e.val()),i=$("#groupYuyueMobile"),a=$.trim(i.val()),n="";if(t?f.actions.checkYuyueName(t)?(e.removeClass("form-input-error"),a?c.CheckMobile(a)?i.removeClass("form-input-error"):(n="请输入正确的手机号",i.addClass("form-input-error")):(n="请输入您的手机号码",i.addClass("form-input-error"))):(n="您输入的姓名格式不正确,请输入正确的姓名！",e.addClass("form-input-error")):(n="请输入您的姓名！",e.addClass("form-input-error")),n)u.msg(n);else{f.actions.submitYuyue(t,a,o,"产品详情页预约 团体咨询")}}}}),$(".layui-layer-btn0").removeClass("layui-layer-btn0").addClass("layui-layer-btn1")}}};return f});