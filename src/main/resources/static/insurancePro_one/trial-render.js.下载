define(function(){"use strict";function t(){}t.prototype={toInt:function(t){return t&&isFinite(t)&&!isNaN(t)?parseInt(t):this.replaceNull(t)},getQueryValue:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=location.search.substr(1).match(e);return null!==a?unescape(a[2]):null},inArray:function(t,e){for(var a=-1,i=0,n=e.length;i<n;i++)e[i]===t&&(a=i);return a},replaceNull:function(t){return t===undefined||"undefined"===t?"":t}};function e(t){var e=t||{};for(var a in this.renderData={},e)this[a]=e[a];this.setData()}for(var a in e.prototype={TEXT_SELECT_MORE:"更多选择",listStyle:" trial-list ",itemStyle:" trial-item ",activeStyle:" filter-active-tag ",getUnit:function(t){return{0:"",1:"份",2:"万元",3:"元",4:"0元",5:"00元",6:"000元",7:"岁",8:"年",9:"月",10:"天",11:"元/年",12:"个",13:"周岁",14:"岁"}[t]||""},setData:function(){var t=this,e=t.data||{};t.restrictRules=e.restrictRules||{},t.security=e.security||{}},getFinalList:function(t,e){for(var a=t||[],i=[],n=0,s=0;s<a.length;s++){var r=a[s],l=r.max,o=r.min,u=r.step,d=r.type,p=r.unit||0;if(2===r.type){for(var c=o;c<=l&&(n++,!(e&&e<n));c+=u)i.push({value:c,max:l,min:o,step:u,unit:p,type:d});!l%u==0&&c!==l+u&&(n++,i.push({value:l,max:l,min:o,step:u,unit:p,type:d}))}else n++,i.push({value:r.value,max:l,min:o,step:u,unit:p,type:d})}return i},renderSelect:function(t){var l=this,e=t||{},a=[],o=e.className||"",u=e.defaultValue||"",d=(e.type,e.item,e.formItem||{}),i=e.list||[],n=e.content||"",p=e.attr||"",s=e.width||"",r=e.listWidth||"",c=e.listHeight||"",h=e.customizeHTML||"",m=!1!==e.showList,f=e.name||l.TEXT_SELECT_MORE,v=e.edit||"ok",y="",I=e.selected,g="",x=d.dictionaryList||[{unit:""}],b=[],w=[];b.push('<ul class="hz-dropdown-menu">'),!i.length&&u&&(f=u+l.getUnit(x[0].unit),g=" filter-active-tag "),i.forEach(function(t,e){var a="",i=t.value+l.getUnit(t.unit),n=t.byname,s=n||i,r=i;d.controlType;3===d.controlType&&(r=t.value,y=t.unit),l.toInt(u)===l.toInt(r)&&(n||!1===I||(o+=" "+l.activeStyle+" "),a=" hz-select-option-selected ",f=s),b.push('<li class="hz-select-option trial-item '+a+"\" data-list='"+JSON.stringify(t)+"' "+p+' data-unit="'+l.getUnit(t.unit)+'" data-value="'+r+'">'+s+"</li>"),w.push('<option value="'+s+'">'+s+"</option>")}),b.push("</ul>");var _=[];return _.push('<div class="others-content">'),_.push("string"==typeof h?h:h()),_.push('<div class="mt10 f12 hidden error-text"><div class="hz-alert hz-alert-error"><span></span></div></div>'),_.push('<div class="mt15"><a class="hz-button hz-button-small button-cancel f14" href="javascript:;" edit="cancel">取消</a><a class="hz-button hz-button-primary hz-button-small button-ok f14" href="javascript:;" data-unit="'+(l.getUnit(x[0].unit)||"")+'" edit="'+v+'">确定</a></div>'),_.push("</div>"),l._dropDownIndex?l._dropDownIndex++:l._dropDownIndex=1,l._dropDownIndex+=(new Date).getTime(),o+=g,a.push('<div data-unit="'+(l.getUnit(y)||"")+'" newselect class="hz-dropdown mr10 '+o+' " '+p+' data-dropdown="dropdown-item-'+l._dropDownIndex+l.productId+"-"+l.productPlanId+"-"+l._dropDownIndex+'" data-default-value="'+u+'" style="width:'+s+'">'),a.push('<div class="input-select">'),a.push('<span class="input-select-text more-tag no-select">'+f+"</span>"),a.push('<b class="iconfont">&#xe70b;</b>'),a.push("</div>"),a.push('<div class="hz-dropdown-content" data-dropdown-item="dropdown-item-'+l._dropDownIndex+l.productId+"-"+l.productPlanId+"-"+l._dropDownIndex+'" abc="'+r+'" style="width:'+r+"; height:"+c+'">'),a.push("string"==typeof n?n:n()),i.length&&m&&a.push(b.join("")),h&&a.push(_.join("")),a.push("</div>"),a.push("</div>"),a.join("")},__renderMore:function(t,e,a){var i=this,n=[],s=a||{},r=s.className||"";s.attr;return i._dropDownIndex?i._dropDownIndex++:i._dropDownIndex=1,n.push('<div class="hz-dropdown mr10 '+r+' " '+s.attr+' data-dropdown="dropdown-item-'+i._dropDownIndex+i.productId+"-"+i.productPlanId+"-"+i._dropDownIndex+'">'),n.push('<div class="input-select">'),n.push('<span class="input-select-text more-tag no-select">'+t+"</span>"),n.push('<b class="iconfont">&#xe70b;</b>'),n.push("</div>"),n.push('<div class="hz-dropdown-content" data-dropdown-item="dropdown-item-'+i._dropDownIndex+i.productId+"-"+i.productPlanId+"-"+i._dropDownIndex+'">'),n.push("string"==typeof e?e:e()),n.push("</div>"),n.push("</div>"),n.join("")},__renderList:function(t){var u=this,d=t||{},p=[],e=d.list||[],a=d.formItem||{},c=d.isSelect,h=" hz-select-option-selected ",m=d.attr,i=d.selectClassName||"",f=d.controlType||a.controlType;return!0===c?p.push('<select name="" id="" class="'+i+'">'):p.push('<ul class="hz-dropdown-menu">'),e.forEach(function(t){var e,a=t.max,i=t.min,n=t.step,s=(t.type,t.unit||0),r=u.itemStyle,l=3!==f;if(20===t.type){for(var o=i;o<=a;o+=n)e=l?o+u.getUnit(s):o,d.defaultValue===e&&(r+=h),!0===c?p.push('<option value="'+e+'">'+o+u.getUnit(s)+"</option>"):p.push('<li class="hz-select-option '+r+' " '+m+' data-default-value="'+e+'">'+o+u.getUnit(s)+"</li>");!a%n==0&&o!==a+n&&(e=l?a+u.getUnit(s):a,u.toInt(d.defaultValue)===u.toInt(e)&&(r+=h),!0===c?p.push('<option value="'+e+'">'+a+u.getUnit(s)+"</option>"):p.push('<li class="hz-select-option '+r+' " '+m+' data-default-value="'+e+'">'+a+u.getUnit(s)+"</li>"))}else e=l?t.value+u.getUnit(s):t.value,u.toInt(d.defaultValue)===u.toInt(e)&&(r+=h),!0===c?p.push('<option value="'+e+'">'+t.value+u.getUnit(s)+"</option>"):p.push('<li class="hz-select-option '+r+' " '+m+' data-default-value="'+e+'" data-unit="'+u.getUnit(s)+'">'+t.value+u.getUnit(s)+"</li>")}),!0===c?p.push("</select>"):p.push("</ul>"),p.join("")},__saveDefaultItem:[],__renderDefaultItem:function(t){var a=this,i=t||{},e=i.list||[],n=[],s=i.item||{},r=i.defaultValue,l=i.className,o=i.attr,u="",d=[],p=s.controlType;return e.forEach(function(t){var e="";t&&(e=+r!==t.value&&r!==t.value+a.getUnit(t.unit)||!r?"":a.activeStyle,2===t.showType?n.push(a.__renderMore(t.byname,function(){return a.__renderList({list:d,attr:o,defaultValue:r,controlType:i.controlType})},{attr:o})):(u=(0===p||2===p)&&-1===t.value.toString().indexOf(a.getUnit(t.unit))?t.value+a.getUnit(t.unit):t.value,a.__saveDefaultItem.push(u),n.push('<span class="'+l+e+'" '+o+" data-list='"+JSON.stringify(t)+"'  data-default-value=\""+u+'" data-unit="'+a.getUnit(t.unit)+'" >'+(t.byname||t.value+a.getUnit(t.unit))+"</span>")))}),n.join("")},hasDefaultValue:function(t,e){var a=!1,i=t||[],n=1;if(!e)return a;for(var s=0,r=i.length;s<r;s++)for(var l=i[s]||{},o=l.max,u=l.min,d=l.step,p=(l.type,u);p<=o;p+=d)if(p===this.toInt(e)&&(a=!0),5<++n){n=1;break}return a},areaOptionWidth:"150px",defaultItemMaxLength:5,renderForm:function(t){var e,a,i,n,s,r=this,l=t||{},o=[],u=l.formObject,d=u.controlType,p=u.key||"",c=u.protectItemId||"",h=u.defaultValue||"",m=u.dictionaryList||[],f=[],v=u.showDictionaryList||[],y=v.length,I=l.isProtect,g=l.additInfo||{},x=u.showUnit||"",b=u.notice||"",w=l.showNotice==undefined||l.showNotice,_=!1===u.enabled?" disabled ":"  ",L=' controlType="'+d+'"   protect="'+!!I+'" _tabindex="0" data-key="'+p+'" data-key="'+p+'" '+_+' data-protectitemid="'+c+'" ',D=" filter-tag "+r.itemStyle+" "+_+" ";switch(r.__saveDefaultItem=[],0===d||2===d?f=r.getFinalList(m):3===d&&(f=r.getFinalList(m,5)),v.length?v.length=5:v=f.slice(0,5),I||0!==d&&2!==d&&3!==d&&5!==d||o.push(r.__renderDefaultItem({list:v,defaultValue:h,className:D,item:u,attr:L,controlType:d})),d){case 0:var E=!1,P=0;if(I||y||(P=r.defaultItemMaxLength),!I&&-1!==r.inArray(h,r.__saveDefaultItem)||(E=!0),!m.length){o.push('<span class=" '+D+r.activeStyle+' " '+L+' data-default-value="'+h+'">'+h+"</span>");break}(y||!y&&5<f.length||I)&&o.push(r.renderSelect({item:u,list:f.slice(P),defaultValue:E?h:"",listWidth:"150px",isProtect:I,attr:L}));break;case 1:D=D.replace(/filter-tag/,""),m.forEach(function(t){var e=t.max,a=t.min,i=t.step,n=t.unit,s=t.type,r=(t.value," data-list='"+JSON.stringify(t)+"' data-min=\""+a+'" data-max="'+e+'" data-step="'+i+'" data-type="'+s+'" data-unit="'+n+'" ');o.push('<input type="text" class="'+D+' Wdate trial-calendar" '+L+" "+r+' value="'+h+'"/>')});break;case 2:var k=f.slice(0,r.defaultItemMaxLength);o.push(r.renderSelect({item:u,list:f,defaultValue:I?h:"",selected:!k.length,type:"time",attr:L,showList:!1,edit:"time",listWidth:"260px",customizeHTML:function(){var t=[];return t.push('<div class="hz-check-item mb10">'),t.push('<i class="hz-check-icon"></i>'),t.push('<span class="check-text f12 no-select">通过<strong>出发</strong>和<strong>结束日期</strong>自动计算保障天数</span>'),t.push("</div>"),t.push('<div class="calendar-box-wrap fn-hide">'),t.push('<div class="mt20"><span class="mr5">出发日期：</span><input type="text" class="Wdate trial-insurant-date-limit" data-type="start"/></div>'),t.push('<div><span class="mr5">结束日期：</span><input type="text" class="Wdate trial-insurant-date-limit" data-type="end"/></div>'),t.push("<div>"),t.push('总计天数： <span data-date=""></span>'),t.push("</div>"),t.push('<div class="mt10 f12">'),t.push('<span class="hz-alert hz-alert-error hidden" data-tips=""><span></span></span>'),t.push("</div>"),t.push("</div>"),t.join("")},content:function(){var t=[];return t.push('<div class="pl10 pr10 mb20 mt20">'),t.push('<span class="mr10">保障天数</span>'),f.unshift({value:r.TEXT_SELECT_MORE}),t.push(r.__renderList({list:f,isSelect:!0,item:u,defaultValue:h,attr:L,selectClassName:"insurant-date-limit-select"})),t.push("</div>"),t.join("")}}));break;case 3:var T=!1;m=m[0],e=m,n=i="",r.__renderDefaultItem({list:v,defaultValue:h,className:D,attr:L}),s=[],e?(I&&(n=r.__renderList({list:v,defaultValue:h,formItem:u,attr:L})),"buyCount"===p&&(i=" product-amount-input  "),a='<input type="text" style="width:160px;" class="only-number other-input-text lh15 input-enter '+i+'" '+L+' data-max="'+e.max+'" data-min="'+e.min+'" data-step="'+e.step+'" data-type="'+e.type+'" data-unit="'+e.unit+'" value=""/>',"buyCount"===p&&(s.push('<div class="product-amount-wrap" data-max="'+e.max+'" data-min="'+e.min+'" data-default="'+h+'">'),s.push('<span class="product-amount-increase">-</span>')),s.push(a),"buyCount"===p&&(s.push('<span class="product-amount-decrease">+</span>'),s.push("</div>")),s.push('<span class="ml10">'+x+"</span>"),e.max&&(s.push('<p class="f12 pt10 fc6">'),s.push("最大"+e.max+r.getUnit(e.unit)+"，需为"+e.step+"的倍数"),s.push("</p>")),T=!r.hasDefaultValue(v,h),o.push(r.renderSelect({item:e,formItem:u,content:n,defaultValue:T?h:"",className:" "+_+" ",listWidth:"260px",customizeHTML:function(){return s.join("")},attr:L}))):o.push(r.renderSelect({item:e,formItem:u,content:n,defaultValue:h,className:" "+_+" ",listWidth:"260px",customizeHTML:function(){return s.join("")},attr:L}));break;case 4:var S=u.subRestrictGeneList||[],V=[],U=S[0],z=S[1],j=u.dictionaryList||[],N=function(t){return' address="'+t+'" data-protectitemid="" data-key="'+t+'" '},C=u.subHide?"fn-hide":"";try{U.dictionaryList.forEach(function(t,e){t.value===U.defaultValue&&t.byname}),V.push(r.renderSelect({list:U.dictionaryList,defaultValue:U.defaultValue,listWidth:this.areaOptionWidth,attr:N(U.key)}))}catch(O){}try{z.dictionaryList.forEach(function(t){t.value===z.defaultValue&&t.byname}),V.push(r.renderSelect({list:z.dictionaryList,listWidth:this.areaOptionWidth,defaultValue:z.defaultValue,attr:N(z.key)}))}catch(O){}try{j.forEach(function(t){t.value===u.defaultValue&&t.byname}),V.push(r.renderSelect({list:j,className:C,listWidth:this.areaOptionWidth,defaultValue:h,attr:N(u.key)}))}catch(O){}o.push(V.join(""));break;case 5:v.length?o.push(r.__renderDefaultItem({list:v,defaultValue:h,className:D,attr:L})):m.length<=r.defaultItemMaxLength?m.forEach(function(t){t.max,t.min,t.step,t.type;var e=t.value,a=t.unit||0,i=h===e+r.getUnit(a)||1===m.length?r.activeStyle:"";o.push('<span class=" '+D+" "+i+'" '+L+' data-default-value="'+e+r.getUnit(a)+'">'+e+r.getUnit(a)+"</span>")}):(o.push(r.__renderDefaultItem({list:m.slice(0,r.defaultItemMaxLength),defaultValue:h,className:D,attr:L})),o.push(r.renderSelect({list:m.slice(r.defaultItemMaxLength),defaultValue:h,attr:L})));break;case 6:m.forEach(function(t){var e=t.unit||0;h=t.defaultValue||t.value+r.getUnit(e)||"",D+=" filter-tag-text filter-active-tag",L+=' data-default-value="'+h+'" ',o.push('<span class="'+D+"\" data-list='"+JSON.stringify(t)+"'"+L+">"+t.value+r.getUnit(e)+"</span>")})}return!g.jobTemplateId||"jobLevel"!==p&&"insurantJob"!==p||o.push('<a href="/product/dialog/job-'+r.productId+'-0.html" target="_blank" rel="nofollow" class="primary-link ml10">查询职业类别</a>'),I||o.push('<span class="show-unit">'+x+"</span>"),w&&b&&o.push('<span class="warn-msg mb10 f12">'+b+"</span>"),o.join("")},__renderAreaList:function(t){var e=(t||{}).item,a=e.dictionaryList||e||[],i=[];return i.push('<ul class="hz-dropdown-menu">'),a.forEach(function(t){i.push('<li class="hz-select-option trial-item " data-default-value="" data-value="'+t.value+'" data-byname="'+t.byname+'">'+t.byname+"</li>")}),i.push("</ul>"),i.join("")},forAdjust:function(){},renderGenesRow:function(t){var e=t||{},a=e.boxClass||"",i=e.titleClass||"",n=e.item||{},s=e.contentClass||"",r=[],l=n.key||n.protectItemId||"",o="list-item-"+this.productPlanId+"-"+l;"insureForSelf"==l&&(this.insureForSelf="是"==(n.value||n.defaultValue));return r.push('<dl class="ensure-opt-item clearfix '+a+'" id="'+o+'" >'),r.push('<dt class="ensure-opt-title fl '+i+'"><strong>'+e.name+"</strong></dt>"),r.push('<dd class="ensure-opt-content '+s+" "+this.listStyle+'"  data-protectitemid="'+(n.protectItemId||"")+'" data-key="'+(n.key||"")+'" data-default-value="'+(n.defaultValue||"")+'">'+("string"==typeof e.content?e.content:e.content())+"</dd>"),r.push("</dl>"),r.join("")},renderGenes:function(){var n=this,a=n.renderData||{},t=a.restrictGenes||[],i=(a.protectTrialItemList,a.preminum,[]),e=a.trialLayoutItemList||[],s={},r=0,l=" bor-bottom mb20 ";if(n.preminum=a.preminum||n.notInsureText,n.trialPrice=a.trialPrice||{},e.length){e.forEach(function(e){var a=e.geneOrderMap||{};for(var i in s[e.title]=[],r++,a)t.forEach(function(t){(t.protectItemId||t.key)===n.toInt(a[i])&&s[e.title].push(t)})});var o=0;for(var u in s)++o===r&&(l=""),s[u].length||(l=""),i.push('<div class="'+l+' pb5 ">'),s[u].forEach(function(t){var e=!1===t.display?"hidden":"";i.push(n.renderGenesRow({boxClass:e,name:t.name,id:t.l,item:t,content:n.renderForm({additInfo:a.additInfo,formObject:t})}))}),i.push("</div>")}else t.forEach(function(t){var e=!1===t.display?"hidden":"";i.push(n.renderGenesRow({boxClass:e,name:t.name,item:t,id:t.protectItemId||t.key,content:n.renderForm({additInfo:a.additInfo,formObject:t})}))});return t.length&&i.push(n.renderGenesRow({name:"保费",content:function(){var t='<span id="preminum-'+n.productPlanId+'">'+n.setPrice()+"</span>";return n.trialPrice.goldenBean&&(t+='<span class="golden-span-wrap">送<span class="golden-span">'+n.trialPrice.goldenBean+"</span>金豆</span>"),a.showEquity&&(t+='<a href="javascript:;" class="ml20 plan-link primary-link" id="lookInterestsDemon">查看现金价值演示</a>'),t}})),i.join("")},editArea:function(t){try{var e=$("[address]");!0===t?e.addClass("disabled"):e.removeClass("disabled")}catch(a){}},notInsureText:"--",setPrice:function(){var t=this,e="",a="",i=t.trialPrice||{};t.isInsure=i.isInsure,undefined!==i.vipPrice?(i.vipPrice!==i.originalPrice&&(a='<del class="fc9 f14 ml10">¥'+(i.originalPrice/100).toFixed(2)+"</del>"),e='<span class="product-price" >¥<i class="preminum-result">'+(i.vipPrice/100).toFixed(2)+"</i></span>"+a,t.editArea()):(e='<div class="product-price" ><i class="preminum-result">'+t.notInsureText+"</i></div>",t.editArea(!0));try{$("#preminum-"+t.productPlanId).html(e)}catch(n){}return e},getRelateCoverageItem:function(e){var a=this,i=null;return a.renderData.restrictGenes.forEach(function(t){t.protectItemId!==a.toInt(e)&&t.key!==e||(i=t)}),i},buildProtect:function(){var t=[],e=this.renderData||{},a=e.protectTrialItemGroup||{},i=e.protectTrialItemList||[];for(var n in this.additInfo=e.additInfo||{},a){var s=a[n],r={name:n,list:[]};s.forEach(function(t){r.list.push(i[t])}),t.push(r)}this.protectList=t||[]},getExplainList:function(t,e){var s=e||"";return(t||[]).forEach(function(t){var e=t.explainName||"",a=t.explainByname||"",i=t.description||"",n="";e?-1!==s.indexOf(e)&&(n='<label class="trial-prompt primary-link explain-list" rel="prompt" data-prompt-width="" data-prompt-html="<div class=\'prompt-content\'>'+i+'</div>" data-prompt-position="top">'+s+"</label>",s=s.replace(e,n)):a&&-1!==s.indexOf(a)&&(n='<label class="trial-prompt primary-link explain-list" rel="prompt" data-prompt-width="" data-prompt-html="<div class=\'prompt-content\'>'+i+'</div>" data-prompt-position="top">'+s+"</label>",s=s.replace(a,n))}),s},identicalProtectItem:{},renderProtectRow:function(t){var l=this,o=[],u=l.additInfo.explainList||[];return l.identicalProtectItem={},l.protectList.length&&(o.push('<div class="detail-ensure-protect f14">'),o.push('<h3 class="f14 pb20 pt20 fb fc6">保障权益</h3>'),l.protectList.forEach(function(t,e){var a=t.list||[];o.push('<ul class="ensure-protect-list">'),o.push('<li class="ensure-protect-item ensure-protect-head">'),o.push('<h4 class="protect-item-title">'+t.name+"</h4>"),o.push("</li>"),a.forEach(function(t){if(t){var e,a=t.description||"",i=l.renderData.protectNoteMap||{},n="";for(var s in i)if(~~t.protectItemId==~~s)for(var r in i[s])a=a.replace(r,'<label rel="prompt" class="trial-prompt primary-link" data-prompt-width="" data-prompt-html=" <div class=\'prompt-content\'>'+i[s][r]+'</div>" data-prompt-position="top" for="" content="'+i[s][r]+'">'+r+"[注]</label>");l.identicalProtectItem[t.name]||(l.identicalProtectItem[t.name]=[]),l.identicalProtectItem[t.name].push(t.name),n=1<l.identicalProtectItem[t.name].length?' style="visibility:hidden;" ':"",o.push('<li class="ensure-protect-item '+l.listStyle+'" id="protect-'+t.protectItemId+"-"+t.trialItemId+'" protectname="'+t.name+'" trialItemId="'+t.trialItemId+'">'),o.push('<div class="row01" '+n+'><div class="protect-item-icon">'+(t.icon?'<img src="'+(t.icon||"").replace("http://","//")+'" width="24" height="24" alt="图标" title="'+t.name+'"/>':'<i class="iconfont icon-item f24">&#xe702;</i>')+"</div></div>"),o.push('<div class="row02" '+n+'><div class="protect-item-name">'),o.push(l.getExplainList(u,t.name)),o.push("</div></div>"),o.push('<div class="row03">'),t.relateCoverageId?(e=l.getRelateCoverageItem(t.relateCoverageId))&&(e.showUnit=t.showUnit,o.push(l.renderForm({item:t,formObject:e,showNotice:!1,isProtect:!0}))):o.push((t.fullPremium?t.fullPremium:t.premium)||""),o.push(t.showUnit),o.push("</div>"),o.push('<div class="row04"><div class="protect-item-des f12 fc6">'+a+"</div></div>"),o.push("</li>")}}),o.push("</ul>")}),o.push("</div>")),o.join("")},renderProtect:function(t){var e=(this.renderData||{}).protectTrialItemList;return this.buildProtect(),this.renderProtectRow(e)}},t.prototype)e.prototype[a]=t.prototype[a];return e});