define([],function(){var ua=window.navigator&&window.navigator.userAgent||"";var referrer=document.referrer||"";var constants={channels:["APPS","HWEI","XIMI","OPPO","VIVO","ANDD","BDPS","BDMS","SGPS","SGMS","SLPS","SLMS","SMMS","WXIN","NUMS","NUPS","NUPS","NUMS"],introduces:["ASO","SEO","REF","DCT"],getSeRule:function(){var types=this.channels.slice(6,13);return[{rule:/.baidu.c/,value:[types[0],types[1]]},{rule:/.sogou.c/,value:[types[2],types[3]]},{rule:/.so.c/,value:[types[4],types[5]]},{rule:/.sm.c/,value:["",types[6]]}]},initCodeMap:[{equal:["//www.huize.com/baoxianyuyue/","//www.huize.com/baoxianyuyue","//m.huize.com/activities/yuyue/bdym/","//m.huize.com/activities/yuyue/bdym"],code:["10","CATDZFA1"]},{match:["//www.huize.com/product/detail","//m.huize.com/product/detail"],code:["10","CATCPXQ1"],ignore:"zaixian"},{match:["//m.huize.com/baoxianxuqiupingce/result"],code:["10","CATXQCP1"]},{match:["//m.huize.com/guwen/hz",],code:["10","CATMPYY1"]},{match:["//m.huize.com/news/consultant/detail-"],code:["10","CATGWZL1"]},{equal:["//qy.huize.com/","//qy.huize.com"],code:["10","CATZXZ11"]},{match:["//m.huize.com/study/studytag/tag","//m.huize.com/study/studytag/stag"],code:["10","CATBKLB1"]},{match:["//m.huize.com/study/studytag/word"],code:["10","CATBKXQ1"]},{match:["//xuexi.huize.com/study","//m.huize.com/study/detail"],code:["10","CATZXXQ1"]},{match:["//m.huize.com/special/list"],code:["10","CATZTLB1"]},{match:["//xuexi.huize.com/special","//m.huize.com/special/detail","//m.huize.com/special/jiaoyu","//m.huize.com/special/jingzhun"],code:["10","CATZTXQ1"]},{match:["//m.huize.com/study/list"],code:["10","CATZXLB1"]},{equal:["//www.huize.com/ketang/","//www.huize.com/ketang","//m.huize.com/ketang/","//m.huize.com/ketang"],code:["10","CATZXZ31"]},{match:[".huize.com/brand/detail",".huize.com/brand/list"],code:["10","CATZXZ41"]},{equal:["//m.huize.com/","//m.huize.com","//www.huize.com/","//www.huize.com"],code:["10","CATZXZ51"]},{match:[".huize.com/product/ins-"],code:["10","CATZXZ61"]},{equal:["//ics.huize.com","//ics.huize.com/","//ics.huize.com/order","//ics.huize.com/order/"],code:["10","CATZXZX1"]},{match:[".huize.com/product/detail-"],code:["10","CATZXZ71"],ignore:"yemian"},{match:[],equal:["//m.huize.com/product/insure/health-inform","//m.huize.com/product/insure/health-inform/","//is.huize.com/product/insure/health-inform","//is.huize.com/product/insure/health-inform/","//www.huize.com/product/insure/health-inform","//www.huize.com/product/insure/health-inform/"],code:["10","CATZXZ81"]},{match:[],equal:["//m.huize.com/guwen/list","//m.huize.com/guwen/list/"],code:["10","CATBDGW1"]}],specialCase:{"h5TopRightMenu":["10","CATZXZX1"]},appChannels:{"002":"APPS","014":"HWEI","010":"XIMI","020":"OPPO","031":"VIVO","default":"ANDD"}};var helper={getQuery:function(key){var pos;var url=location.href;pos=url.indexOf("?")+1;if(pos===0){return""}url="&"+url.substr(pos).split("#")[0];var reg=new RegExp("&"+key+"(?:=([^&]*)|&|$)");var match=url.match(reg);if(match){try{return decodeURIComponent(match[1]||"")}catch(e){return match[1]}}return""},regMatch:function(rule,str){if(!(rule instanceof RegExp)){return false}return rule.test(str)},getCookie:function(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");if(arr=document.cookie.match(reg)){return unescape(arr[2])}else{return""}},getAndriodChannel:function(){if(window.basics&&typeof window.basics.getChannel==="function"){var channels=window.basics.getChannel()||"";var key=channels.split("_")[1];if(constants.appChannels[key]){return constants.appChannels[key]}}return constants.appChannels["default"]}};var utils={hzApp:function(){return{isAndriodApp:ua.indexOf("hzins")>-1||/APP_ANDROID_HUTS/i.test(ua),isIOSApp:ua.indexOf("mainApp")>-1||/APP_IOS_HUTS/i.test(ua)}},isWeixin:function(){return/micromessenger/.test(ua.toLowerCase())},isMobile:function(){return helper.regMatch(/mainApp|hzins|Android|Adr|iPhone|iPad|iPod|iOS|Mobile/i,ua)},getSearchEngine:function(){var search_engines=constants.getSeRule();for(var i=0;i<search_engines.length;i++){if(helper.regMatch(search_engines[i].rule,helper.getCookie("introductionUrl")||"")){return search_engines[i].value}}return null}};var result={app:utils.hzApp(),engine:utils.getSearchEngine(),getFlowType:function(defaultValue){var introduction_url=helper.getCookie("introductionUrl")||"";var types=constants.introduces;if(this.app.isAndriodApp||this.app.isIOSApp){return types[0]}if(defaultValue&&defaultValue!=="OTH"){return defaultValue}if(!!this.engine){return types[1]}if(introduction_url.indexOf("huize.com")<0&&introduction_url){return types[2]}return types[3]},getChannel:function(originChannel){var types=constants.channels;if(this.app.isIOSApp){return types[0]}if(this.app.isAndriodApp){return helper.getAndriodChannel()}if(originChannel&&originChannel!=="NULL"){return originChannel}var isM=utils.isMobile();if(this.engine){var res=isM?this.engine[1]:this.engine[0];if(res){return res}}if(utils.isWeixin()){return types[13]}var origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");
var url=(origin+location.pathname).replace(/^http(s)?:/,"");if(url.indexOf("m.huize.com")>-1||url.indexOf("ics.huize.com")>-1){return types[14]}if(url.indexOf("huize.com")>-1){return types[15]}if(!isM){return types[16]}return types[17]},getInitCode:function(params){if(params.special){return constants.specialCase[params.special]}var codeMap=constants.initCodeMap;var url=(location.origin+location.pathname).replace(/^http(s)?:/,"");for(var i=0;i<codeMap.length;i++){var codeItem=codeMap[i];if(codeItem.ignore&&params.ignore&&codeItem.ignore===params.ignore){continue}if(codeItem.equal instanceof Array){for(var j=0;j<codeItem.equal.length;j++){if(url===codeItem.equal[j]){return codeItem.code}}}if(codeItem.match instanceof Array){for(var k=0;k<codeItem.match.length;k++){if(url.indexOf(codeItem.match[k])>-1){return codeItem.code}}}}return""},generateCode:function(params){var init=this.getInitCode(params);if(!init){return""}var flowType=this.getFlowType();var channel=this.getChannel();return init[0]+""+flowType+""+channel+init[1]},getCodeBySource:function(originCode){if(originCode.length<10){return originCode}var call_center=originCode.substr(0,2);var flowType=result.getFlowType(originCode.substr(2,3));var channel=this.getChannel(originCode.substr(5,4));var others=originCode.substr(9);return call_center+""+flowType+""+channel+""+others},getPlanId:function(){return helper.getQuery("DProtectPlanId")||undefined},getProductId:function(){return(location.pathname.match(/\/detail-(\d+)\.html/)||["",""])[1]||undefined}};return{getCode:function(params){var priority2=helper.getCookie("campaign_code");var utm=helper.getCookie("UtmCookieKey");var priority3="";if(utm){try{priority3=JSON.parse(utm).CampaignCode}catch(e){}}var origin=(priority3||priority2).toUpperCase();var code=origin?result.getCodeBySource(origin):result.generateCode(params||{});return String(code||"").split(",")[0]},getPlanId:result.getPlanId,getProductId:result.getProductId}});