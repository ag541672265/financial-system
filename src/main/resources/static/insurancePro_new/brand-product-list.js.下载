define(["jquery","helper","layer","fixed-tool-float","animate-fly","kkpager","jquery-tab"],function($,l,s,c,t){"use strict";return{toolFloat:{},init:function(){this.initEvent(),this.getHistory(),this.yuyue(),this.brand(),this.onlineChat()},onlineChat:function(){$("body").on("click",".pingpai-chat",function(){var t=l.jointReferrer(),e="//is.huize.com/api/users/kefuRewrite?referrer="+encodeURIComponent(t)+"&title="+encodeURIComponent(document.title)+"&businessType=Xm4FWr0dncw";window.open(e,"kefu","toolbar=no,location=no,directories=no,resizable=yes,status=yes,menubar=no,scrollbars=yes,width=800,height=600,left=0,top=0")})},brand:function(){$("#parentTab").tab("#parentContent",{titleCurrent:"tab-active1",contentCurrent:"tab-content-active1"}),$("#subTab1").tab("#subContent1",{titleCurrent:"tab-active2",contentCurrent:"tab-content-active2"}),$("#subTab2").tab("#subContent2",{titleCurrent:"tab-active2",contentCurrent:"tab-content-active2"})},yuyue:function(){var n=this,a="360px",o=($("#yuyueHtml").html(),$("#yuyueSuccessHtml").html()),r=$("#yuyueErrorHtml").html();$.get("/api/reserve/getCurrentAppointCount",function(t){t&&t.result!==undefined&&$("#currentAppointCount").text(t.result)}),$("body").on("click",".yuyue-submit",function(){var t=$("#userName").val(),e=$("#userTel").val();if(t.length)if(/^1[0-9]{10}$/.test(e)){var i={customerName:t,mobile:e,urlReferrer:window.location.href,oppDesc:"",source:1,oppName:"seo保险品牌",yuyueType:2,classify:4};n.yuyueStatus||(n.yuyueStatus=!0,$.ajax({url:"//activities.huize.com/activities/api/common/Appointment",type:"get",dataType:"jsonp",jsonp:"callback",data:i,complete:function(){n.yuyueStatus=!1},success:function(t){n.yuyueStatus=!1,"00000"===t.status?function e(){s.open({skin:"layer-2 layer-2-btn",title:"您已预约成功",area:[a,"350px"],content:o,btn:!1}),$("#userName").val(""),$("#userTel").val("")}():function i(){s.open({skin:"layer-2 layer-2-btn",title:"预约失败",btn:["重新预约"],area:[a,"230px"],content:r})}()}}))}else s.alert("请输入合法的手机号码");else s.alert("请输入您的姓名")})},initEvent:function(){var e=this,t=$("#subCategory").val()||"0",i=$("#companyId").val()||"0",n=($("#filter").val(),$("#pageIndex").val()||0),a=$("#totalCount").val()||0,o="/brand/detail/"+i+"/"+(0==~~t?"":t+"/");1!==n&&(kkpager.generPageHtml({pno:$("#pageIndex").val(),total:Math.ceil(a/5),totalRecords:a,hrefFormer:o,hrefLatter:"?page=",getLink:function(t){return 1===t?this.hrefFormer:this.hrefFormer+this.hrefLatter+t},mode:"link",isGoPage:!1,isShowTotalPage:!1,isShowCurrPage:!1,lang:{firstPageText:"首页",firstPageTipText:"首页",lastPageText:"尾页",lastPageTipText:"尾页",prePageText:"上一页",prePageTipText:"上一页",nextPageText:"下一页",nextPageTipText:"下一页"}}),kkpager.selectPage($("#pageIndex").val())),e.toolFloat=new c,$(".hz-product-list").delegate(".add-compare","click",function(){var t=$(this);if($(this).hasClass("hz-check-item-checked"))$(this).removeClass("hz-check-item-checked"),e.toolFloat.delcomparePro($(this).attr("planId")||$(this).attr("productId")),$(this).find(".hz-check-text").text("加入对比");else{if(4<=e.toolFloat.getCompareCount())return void s.msg("对比数目最大不能超过4个");$(this).addClass("hz-check-item-checked"),$("#fixedsidetool").css("right",0),$("#wrapToolMenu").css("left",0),e.animateFly($(this),$("#compareCount"),function(){e.toolFloat.addcomparePro(t.attr("planId")||t.attr("productId"))})}});var r=l.cookie.getCookie("compareProducts").split(",")||[];$.each(r,function(){$(".add-compare[planid="+this+"]").addClass("hz-check-item-checked")})},initAction:function(){$("#historyData").on("click","#nextBtn",function(){if(!($("#viewWraper li").length<4)){var t=$("#viewContainer ul").width(),e=$("#viewContainer").scrollLeft(),i=t<e?$("#viewContainer ul").eq(0):[];2*t-e==1208&&($("#historyViewWrap ul").eq(0).remove(),$("#historyViewWrap").append(i),$("#viewContainer").scrollLeft(e-t)),e=$("#viewContainer").scrollLeft(),$("#viewContainer").scrollLeft(e+302)}}).on("click","#prevBtn",function(){if(!($("#viewWraper li").length<4)){var t=$("#viewContainer ul").width(),e=$("#viewContainer").scrollLeft(),i=$("#viewContainer ul").eq(1);1208===e&&($("#historyViewWrap ul").eq(1).remove(),i.insertBefore($("#historyViewWrap ul")),$("#viewContainer").scrollLeft(e+t)),e=$("#viewContainer").scrollLeft(),$("#viewContainer").scrollLeft(e-302)}})},getHistory:function(){var t=l.cookie.getCookie("Product_History").split(","),e=[];t=$.grep(t,function(t){return""!==t}),$.each(t,function(t){this.split(":")[1]&&e.push(this.split(":")[1])}),l.request.postData2({url:"/api/products/plans/list",data:e},function(t){if(t.result.length){var e=(t.result||[]).filter(function(t,e){return 1===t.productStatus})||[],n=[];n.push('<ul class="view-history-list clearfix"  style="position: relative; left: 0px;margin-right:0px" id="viewWraper" index="1" >'),$.each(e,function(t,e){var i="//www.huize.com/product/detail-"+e.productId+".html?DProtectPlanId="+e.planId;n.push('<li class="view-history-item fl">'),n.push('<h4 class="view-history-item-title mb10"><a target="_blank" href="'+i+'">'+e.productName+e.planName+"</a></h4>"),n.push('<a href="'+i+'" class="product-pic" target="_blank">'),n.push('<img width="100%" src="'+e.planBigImg+'">'),n.push("</a>"),n.push("</li>")}),n.push("</ul>");var i=$(n.join("")),a=e.length,o=302*a,r=4<a?i.width(o).css("float","left").clone().attr("id","historyListClone"):"",l=$("<div id='historyViewWrap'></div>").append(i).append(r).width(o*(4<a?2:1));$("#viewContainer").html(l).scrollLeft(o),a<=4?$("#prevBtn,#nextBtn").addClass("view-history-scroll-prev-disabled"):$("#viewHistoryPage").removeClass("fn-hide")}else $("#viewContainer").hide(),$("#emptyData").show(),$("#prevBtn,#nextBtn").addClass("view-history-scroll-prev-disabled")}),this.initAction()},animateFly:function(t,e,i){var n=$('<img class="u-flyer" src="//img.huizecdn.com/hz/www/page/cart-flyer.png">').width(40).height(40),a=document.body.scrollTop||document.documentElement.scrollTop,o=t.offset().top-t.height()/2-a,r=t.offset().left+t.width()/2,l=e.offset().top+e.height()/2-a;n.fly({start:{left:r,top:o},end:{left:e.offset().left,top:l,width:0,height:0},onEnd:function(){"function"==typeof i&&i()}})}}});